<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carbon Footprint Calculator | Soular</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#40a2ff',
                        secondary: '#ff2941',
                        darkbg: '#181818',
                        darkcard: '#2A2A2A'
                    }
                }
            }
        };

        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Language translations
        const translations = {
            en: {
                title: "Carbon Footprint Calculator",
                lifestyle: "Your Lifestyle Details",
                transport: {
                    title: "Transportation",
                    primaryVehicle: "Primary Vehicle/Mode",
                    vehicles: {
                        car_gas_avg: "Car (Average Gas)",
                        car_electric: "Car (Electric)",
                        motorcycle: "Motorcycle",
                        bus: "Primarily Bus",
                        train: "Primarily Train",
                        bike_walk: "Primarily Bike/Walk"
                    },
                    weeklyMiles: "Weekly Miles in Private Vehicle (Car/Motorcycle)",
                    publicMiles: "Weekly Miles via Public Transport (Bus/Train)",
                    flights: {
                        short: "Short Flights/yr (<3hr)",
                        medium: "Medium Flights/yr (3-6hr)",
                        long: "Long Flights/yr (>6hr)"
                    },
                    estimate: "Est. Transport"
                },
                food: {
                    title: "Food & Diet",
                    dietType: "Describe Your Diet",
                    diets: {
                        meat_heavy: "Meat in most meals",
                        meat_average: "Average omnivore (meat 5-7 times/week)",
                        vegetarian: "Vegetarian (no meat/fish)",
                        vegan: "Vegan (no animal products)"
                    },
                    estimate: "Est. Food"
                },
                energy: {
                    title: "Home Energy",
                    homeType: "Type of Home",
                    homes: {
                        apartment: "Apartment / Condo",
                        small_house: "Small House (~1000 sqft)",
                        medium_house: "Medium House (~2000 sqft)",
                        large_house: "Large House (>2500 sqft)"
                    },
                    heatingSource: "Primary Heating Source",
                    heating: {
                        natural_gas: "Natural Gas",
                        heating_oil: "Heating Oil",
                        propane: "Propane",
                        electric: "Electric (Baseboard/Furnace)",
                        other_renewable: "Wood / Solar / Geothermal"
                    },
                    manualElectricity: "Manually enter annual electricity usage?",
                    annualElectricity: "Annual Electricity (kWh)",
                    manualHeating: "Manually enter annual heating fuel usage?",
                    annualHeating: "Annual Heating Fuel",
                    estimate: "Est. Energy"
                },
                goods: {
                    title: "Goods & Services",
                    spending: "Spending on non-essential goods (clothing, electronics, furniture, entertainment etc.)",
                    levels: {
                        low: "Low (Minimal, mostly essentials)",
                        medium: "Medium (Average purchases)",
                        high: "High (Frequent purchases, latest trends)",
                        very_high: "Very High (Luxury goods, frequent upgrades)"
                    },
                    estimate: "Est. Goods"
                },
                footprint: {
                    title: "Your Estimated Carbon Footprint",
                    transport: "Transportation",
                    food: "Food & Diet",
                    energy: "Home Energy",
                    goods: "Goods & Services",
                    total: "tons COâ‚‚e / year",
                    impact: "Your Impact",
                    levels: {
                        veryHigh: "Very High",
                        high: "High",
                        medium: "Medium",
                        low: "Low"
                    },
                    averages: "Global average: ~4.8 tons | HK average: ~4.4 tons"
                },
                recommendations: {
                    title: "Personal Recommendations",
                    commit: "Commit to Taking Action",
                    success: "ğŸ‰ Commitment registered! +50 points",
                    messages: {
                        highFootprint: "Your footprint is significantly high. Consider major lifestyle changes across categories.",
                        transport: {
                            highCar: "Transportation Footprint High: Explore reducing car travel, using public transport, biking, or considering a more fuel-efficient/electric vehicle.",
                            highFlights: "Transportation Footprint High: Reduce air travel, especially long-haul flights, or consider carbon offsets.",
                            medium: "Transportation: Look for opportunities to combine trips, carpool, or use public transport for some journeys."
                        },
                        food: {
                            high: "Food Footprint High: Reduce consumption of red meat (beef, lamb). Explore more plant-based meals.",
                            medium: "Food: Try incorporating more 'Meatless Mondays' or reducing meat portion sizes."
                        },
                        energy: {
                            high: "Energy Footprint High: Investigate home insulation improvements, switch to LED lighting, unplug unused electronics, and consider energy-efficient appliances.",
                            heating: "Energy: Explore options for switching to renewable heating sources or improving heating system efficiency.",
                            medium: "Energy: Adjust thermostat settings seasonally, seal air leaks around windows/doors, and use smart power strips."
                        },
                        goods: {
                            high: "Goods/Services Footprint High: Focus on reducing consumption, buying secondhand, repairing items, and choosing products with minimal packaging.",
                            medium: "Goods/Services: Prioritize experiences over material goods, borrow or rent items when possible, and recycle diligently."
                        },
                        lowFootprint: "Great job maintaining a lower footprint! Consider sharing your sustainable practices or exploring local environmental initiatives.",
                        solar: "Look into community solar or advocating for sustainable policies.",
                        generic: [
                            "Switch to a renewable energy provider if available.",
                            "Reduce food waste by planning meals and composting.",
                            "Support businesses with strong sustainability practices."
                        ]
                    }
                },
                didYouKnow: {
                    title: "Did You Know?",
                    content: "Reducing your carbon footprint by just 1 ton is equivalent to planting 16.5 trees or taking one car off the road for three months!",
                    learnMore: "Learn more"
                }
            },
            zh: {
                title: "ç¢³è¶³è·¡è¨ˆç®—å™¨",
                lifestyle: "æ‚¨çš„ç”Ÿæ´»æ–¹å¼è©³æƒ…",
                transport: {
                    title: "äº¤é€šé‹è¼¸",
                    primaryVehicle: "ä¸»è¦äº¤é€šå·¥å…·",
                    vehicles: {
                        car_gas_avg: "æ±½æ²¹è»Šï¼ˆå¹³å‡ï¼‰",
                        car_electric: "é›»å‹•è»Š",
                        motorcycle: "æ‘©æ‰˜è»Š",
                        bus: "ä¸»è¦æ­ä¹˜å·´å£«",
                        train: "ä¸»è¦æ­ä¹˜ç«è»Š",
                        bike_walk: "ä¸»è¦é¨è‡ªè¡Œè»Š/æ­¥è¡Œ"
                    },
                    weeklyMiles: "æ¯é€±ç§äººè»Šè¼›è¡Œé§›é‡Œç¨‹ï¼ˆæ±½è»Š/æ‘©æ‰˜è»Šï¼‰",
                    publicMiles: "æ¯é€±å…¬å…±äº¤é€šé‡Œç¨‹ï¼ˆå·´å£«/ç«è»Šï¼‰",
                    flights: {
                        short: "çŸ­ç¨‹èˆªç­/å¹´ï¼ˆ<3å°æ™‚ï¼‰",
                        medium: "ä¸­ç¨‹èˆªç­/å¹´ï¼ˆ3-6å°æ™‚ï¼‰",
                        long: "é•·ç¨‹èˆªç­/å¹´ï¼ˆ>6å°æ™‚ï¼‰"
                    },
                    estimate: "é ä¼°äº¤é€šé‹è¼¸"
                },
                food: {
                    title: "é£²é£Ÿç¿’æ…£",
                    dietType: "æè¿°æ‚¨çš„é£²é£Ÿç¿’æ…£",
                    diets: {
                        meat_heavy: "å¤§å¤šé¤é»å«è‚‰",
                        meat_average: "ä¸€èˆ¬è‘·é£Ÿï¼ˆæ¯é€±é£Ÿç”¨è‚‰é¡5-7æ¬¡ï¼‰",
                        vegetarian: "ç´ é£Ÿï¼ˆä¸é£Ÿç”¨è‚‰é¡/é­šé¡ï¼‰",
                        vegan: "ç´”ç´ ï¼ˆä¸é£Ÿç”¨ä»»ä½•å‹•ç‰©ç”¢å“ï¼‰"
                    },
                    estimate: "é ä¼°é£²é£Ÿ"
                },
                energy: {
                    title: "å®¶åº­èƒ½æº",
                    homeType: "ä½å®…é¡å‹",
                    homes: {
                        apartment: "å…¬å¯“/å¥—æˆ¿",
                        small_house: "å°å‹æˆ¿å±‹ï¼ˆç´„93å¹³æ–¹ç±³ï¼‰",
                        medium_house: "ä¸­å‹æˆ¿å±‹ï¼ˆç´„186å¹³æ–¹ç±³ï¼‰",
                        large_house: "å¤§å‹æˆ¿å±‹ï¼ˆ>232å¹³æ–¹ç±³ï¼‰"
                    },
                    heatingSource: "ä¸»è¦ä¾›æš–ä¾†æº",
                    heating: {
                        natural_gas: "å¤©ç„¶æ°£",
                        heating_oil: "æš–æ°£æ²¹",
                        propane: "ä¸™çƒ·",
                        electric: "é›»åŠ›ï¼ˆé›»æš–å™¨/æš–çˆï¼‰",
                        other_renewable: "æœ¨æ/å¤ªé™½èƒ½/åœ°ç†±"
                    },
                    manualElectricity: "æ‰‹å‹•è¼¸å…¥å¹´åº¦ç”¨é›»é‡ï¼Ÿ",
                    annualElectricity: "å¹´åº¦ç”¨é›»é‡ï¼ˆåƒç“¦æ™‚ï¼‰",
                    manualHeating: "æ‰‹å‹•è¼¸å…¥å¹´åº¦ä¾›æš–ç‡ƒæ–™ä½¿ç”¨é‡ï¼Ÿ",
                    annualHeating: "å¹´åº¦ä¾›æš–ç‡ƒæ–™",
                    estimate: "é ä¼°èƒ½æº"
                },
                goods: {
                    title: "å•†å“èˆ‡æœå‹™",
                    spending: "éå¿…éœ€å“æ”¯å‡ºï¼ˆæœé£¾ã€é›»å­ç”¢å“ã€å®¶å…·ã€å¨›æ¨‚ç­‰ï¼‰",
                    levels: {
                        low: "ä½ï¼ˆæœ€ä½é™åº¦ï¼Œä¸»è¦ç‚ºå¿…éœ€å“ï¼‰",
                        medium: "ä¸­ç­‰ï¼ˆä¸€èˆ¬è³¼ç‰©ï¼‰",
                        high: "é«˜ï¼ˆç¶“å¸¸è³¼ç‰©ï¼Œè¿½é€æ½®æµï¼‰",
                        very_high: "æ¥µé«˜ï¼ˆå¥¢ä¾ˆå“ï¼Œé »ç¹æ›´æ–°ï¼‰"
                    },
                    estimate: "é ä¼°å•†å“"
                },
                footprint: {
                    title: "æ‚¨çš„é ä¼°ç¢³è¶³è·¡",
                    transport: "äº¤é€šé‹è¼¸",
                    food: "é£²é£Ÿç¿’æ…£",
                    energy: "å®¶åº­èƒ½æº",
                    goods: "å•†å“èˆ‡æœå‹™",
                    total: "å™¸äºŒæ°§åŒ–ç¢³ç•¶é‡/å¹´",
                    impact: "æ‚¨çš„å½±éŸ¿",
                    levels: {
                        veryHigh: "éå¸¸é«˜",
                        high: "é«˜",
                        medium: "ä¸­ç­‰",
                        low: "ä½"
                    },
                    averages: "å…¨çƒå¹³å‡ï¼šç´„4.8å™¸ | é¦™æ¸¯å¹³å‡ï¼šç´„4.4å™¸"
                },
                recommendations: {
                    title: "å€‹äººå»ºè­°",
                    commit: "æ‰¿è«¾æ¡å–è¡Œå‹•",
                    success: "ğŸ‰ å·²è¨˜éŒ„æ‰¿è«¾ï¼+50ç©åˆ†",
                    messages: {
                        highFootprint: "æ‚¨çš„ç¢³è¶³è·¡é¡¯è‘—åé«˜ã€‚è«‹è€ƒæ…®åœ¨å„å€‹æ–¹é¢æ”¹è®Šç”Ÿæ´»æ–¹å¼ã€‚",
                        transport: {
                            highCar: "äº¤é€šç¢³è¶³è·¡åé«˜ï¼šè€ƒæ…®æ¸›å°‘é–‹è»Šï¼Œæ”¹ç”¨å…¬å…±äº¤é€šå·¥å…·ã€é¨è‡ªè¡Œè»Šï¼Œæˆ–é¸æ“‡æ›´ç¯€èƒ½/é›»å‹•çš„è»Šè¼›ã€‚",
                            highFlights: "äº¤é€šç¢³è¶³è·¡åé«˜ï¼šæ¸›å°‘èˆªç©ºæ—…è¡Œï¼Œç‰¹åˆ¥æ˜¯é•·é€”èˆªç­ï¼Œæˆ–è€ƒæ…®è³¼è²·ç¢³è£œå„Ÿã€‚",
                            medium: "äº¤é€šå»ºè­°ï¼šå°‹æ‰¾æ©Ÿæœƒåˆä½µè¡Œç¨‹ã€å…±ä¹˜ï¼Œæˆ–åœ¨æŸäº›æ—…ç¨‹ä¸­ä½¿ç”¨å…¬å…±äº¤é€šå·¥å…·ã€‚"
                        },
                        food: {
                            high: "é£²é£Ÿç¢³è¶³è·¡åé«˜ï¼šæ¸›å°‘ç´…è‚‰ï¼ˆç‰›è‚‰ã€ç¾Šè‚‰ï¼‰çš„æ”å…¥ã€‚æ¢ç´¢æ›´å¤šæ¤ç‰©æ€§é¤é»ã€‚",
                            medium: "é£²é£Ÿå»ºè­°ï¼šå˜—è©¦å¯¦è¡Œã€Œç„¡è‚‰æ˜ŸæœŸä¸€ã€æˆ–æ¸›å°‘è‚‰é¡ä»½é‡ã€‚"
                        },
                        energy: {
                            high: "èƒ½æºç¢³è¶³è·¡åé«˜ï¼šç ”ç©¶æ”¹å–„æˆ¿å±‹éš”ç†±ã€è½‰æ›LEDç…§æ˜ã€æ‹”æ‰æœªä½¿ç”¨çš„é›»å™¨æ’é ­ï¼Œä¸¦è€ƒæ…®ä½¿ç”¨ç¯€èƒ½é›»å™¨ã€‚",
                            heating: "èƒ½æºå»ºè­°ï¼šæ¢ç´¢è½‰æ›ç‚ºå¯å†ç”Ÿèƒ½æºä¾›æš–æˆ–æ”¹å–„ä¾›æš–ç³»çµ±æ•ˆç‡çš„é¸é …ã€‚",
                            medium: "èƒ½æºå»ºè­°ï¼šæ ¹æ“šå­£ç¯€èª¿æ•´æ†æº«å™¨è¨­å®šï¼Œå¯†å°é–€çª—å‘¨åœçš„æ¼æ°£è™•ï¼Œä½¿ç”¨æ™ºèƒ½é›»æºæ’åº§ã€‚"
                        },
                        goods: {
                            high: "å•†å“/æœå‹™ç¢³è¶³è·¡åé«˜ï¼šè‘—é‡æ–¼æ¸›å°‘æ¶ˆè²»ï¼Œè³¼è²·äºŒæ‰‹å•†å“ï¼Œç¶­ä¿®ç‰©å“ï¼Œé¸æ“‡åŒ…è£æœ€å°‘çš„ç”¢å“ã€‚",
                            medium: "å•†å“/æœå‹™å»ºè­°ï¼šå„ªå…ˆé¸æ“‡é«”é©—è€Œéç‰©è³ªå•†å“ï¼Œå¯èƒ½æ™‚å€Ÿç”¨æˆ–ç§Ÿç”¨ç‰©å“ï¼ŒèªçœŸå›æ”¶ã€‚"
                        },
                        lowFootprint: "åšå¾—å¥½ï¼ä¿æŒè¼ƒä½çš„ç¢³è¶³è·¡ï¼è€ƒæ…®åˆ†äº«æ‚¨çš„ç’°ä¿å¯¦è¸æˆ–æ¢ç´¢æœ¬åœ°ç’°ä¿è¨ˆåŠƒã€‚",
                        solar: "äº†è§£ç¤¾å€å¤ªé™½èƒ½é …ç›®æˆ–å€¡å°å¯æŒçºŒç™¼å±•æ”¿ç­–ã€‚",
                        generic: [
                            "å¦‚æœå¯èƒ½ï¼Œè½‰æ›åˆ°å¯å†ç”Ÿèƒ½æºä¾›æ‡‰å•†ã€‚",
                            "é€šéè¦åŠƒç”¨é¤å’Œå †è‚¥ä¾†æ¸›å°‘é£Ÿç‰©æµªè²»ã€‚",
                            "æ”¯æŒå…·æœ‰å¼·çƒˆå¯æŒçºŒç™¼å±•ç†å¿µçš„ä¼æ¥­ã€‚"
                        ]
                    }
                },
                didYouKnow: {
                    title: "æ‚¨çŸ¥é“å—ï¼Ÿ",
                    content: "æ¸›å°‘1å™¸ç¢³è¶³è·¡ç›¸ç•¶æ–¼ç¨®æ¤16.5æ£µæ¨¹æˆ–æ¸›å°‘ä¸€è¼›æ±½è»Šä¸‰å€‹æœˆçš„é“è·¯è¡Œé§›ï¼",
                    learnMore: "äº†è§£æ›´å¤š"
                }
            }
        };
    </script>
    <style>
        .loader { /* Style unchanged */ }
        @keyframes spinner { /* Style unchanged */ }
        .carbon-gauge { /* Style unchanged */ }
        label { display: block; margin-bottom: 0.25rem; font-size: 0.875rem; font-medium; }
        select, input[type="number"] {
            width: 100%;
            padding: 0.5rem;
            border-radius: 0.375rem;
            border: 1px solid #D1D5DB; /* gray-300 */
            background-color: #FFF; /* white */
            color: #111827; /* gray-900 */
        }
        .dark select, .dark input[type="number"] {
            border-color: #4B5563; /* dark:gray-600 */
            background-color: #374151; /* dark:gray-700 */
            color: #F9FAFB; /* dark:gray-50 */
        }
    </style>
</head>
<body class="bg-white dark:bg-darkbg text-gray-900 dark:text-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        const EMISSION_FACTORS = {
            transport: {
                car_gas_avg: 0.40,
                car_electric: 0.15,
                bus: 0.10,
                train: 0.08,
                motorcycle: 0.18,
                plane_short: 0.25,
                plane_medium: 0.18,
                plane_long: 0.15,
            },
            diet: {
                meat_heavy: 3.3,
                meat_average: 2.5,
                vegetarian: 1.7,
                vegan: 1.5,
            },
            energy: {
                electricity_kwh: 0.4,
                natural_gas_therm: 5.3,
                heating_oil_gallon: 10.1,
                propane_gallon: 5.7,
                home_electricity: {
                    apartment: 4000,
                    small_house: 8000,
                    medium_house: 11000,
                    large_house: 15000,
                },
                home_heating_gas: {
                    apartment: 300,
                    small_house: 500,
                    medium_house: 700,
                    large_house: 1000,
                },
                home_heating_oil: {
                    apartment: 200,
                    small_house: 400,
                    medium_house: 600,
                    large_house: 800,
                },
                home_heating_propane: {
                    apartment: 250,
                    small_house: 450,
                    medium_house: 650,
                    large_house: 900,
                }
            },
            goods: {
                low: 0.8,
                medium: 1.5,
                high: 3.0,
                very_high: 5.0
            }
        };

        function App() {
            const [language, setLanguage] = useState('zh');
            const t = translations[language];

            const [inputs, setInputs] = useState({
                primaryVehicle: 'car_gas_avg',
                weeklyMilesDriven: 50,
                publicTransportMiles: 10,
                flightsShortPerYear: 1,
                flightsMediumPerYear: 1,
                flightsLongPerYear: 0,
                dietType: 'meat_average',
                homeType: 'medium_house',
                electricityUsageKnown: false,
                annualKWh: EMISSION_FACTORS.energy.home_electricity.medium_house,
                primaryHeatingFuel: 'natural_gas',
                heatingUsageKnown: false,
                annualHeatingUnits: EMISSION_FACTORS.energy.home_heating_gas.medium_house,
                shoppingHabits: 'medium',
            });

            const [user, setUser] = useState({
                name: "Guest User",
                points: 240,
                level: 3,
                footprint: 8.2,
                actions: 12,
                avatar: "https://i.imgur.com/HYsTHOF.png"
            });

            const [showModal, setShowModal] = useState(false);
            const [modalContent, setModalContent] = useState("");

            const handleInputChange = (event) => {
                const { name, value, type, checked } = event.target;
                const val = type === 'checkbox' ? checked : (type === 'number' ? parseFloat(value) || 0 : value);

                setInputs(prev => {
                    const newState = { ...prev, [name]: val };

                    if (name === 'homeType') {
                        if (!newState.electricityUsageKnown) {
                            newState.annualKWh = EMISSION_FACTORS.energy.home_electricity[val] || 0;
                        }
                        if (!newState.heatingUsageKnown) {
                           const fuel = newState.primaryHeatingFuel;
                           if (fuel === 'natural_gas') newState.annualHeatingUnits = EMISSION_FACTORS.energy.home_heating_gas[val] || 0;
                           else if (fuel === 'heating_oil') newState.annualHeatingUnits = EMISSION_FACTORS.energy.home_heating_oil[val] || 0;
                           else if (fuel === 'propane') newState.annualHeatingUnits = EMISSION_FACTORS.energy.home_heating_propane[val] || 0;
                           else newState.annualHeatingUnits = 0;
                        }
                    }
                     if (name === 'primaryHeatingFuel' && !newState.heatingUsageKnown) {
                           const home = newState.homeType;
                           if (val === 'natural_gas') newState.annualHeatingUnits = EMISSION_FACTORS.energy.home_heating_gas[home] || 0;
                           else if (val === 'heating_oil') newState.annualHeatingUnits = EMISSION_FACTORS.energy.home_heating_oil[home] || 0;
                           else if (val === 'propane') newState.annualHeatingUnits = EMISSION_FACTORS.energy.home_heating_propane[home] || 0;
                           else newState.annualHeatingUnits = 0;
                    }

                    return newState;
                });
            };

            const footprintData = useMemo(() => {
                let transport = 0;
                let food = 0;
                let energy = 0;
                let goods = 0;

                const annualMilesDriven = inputs.weeklyMilesDriven * 52;
                const vehicleFactor = EMISSION_FACTORS.transport[inputs.primaryVehicle] || 0;
                transport += (annualMilesDriven * vehicleFactor) / 1000;

                const annualPublicMiles = inputs.publicTransportMiles * 52;
                transport += (annualPublicMiles * EMISSION_FACTORS.transport.bus) / 1000;

                const shortFlightDist = 500;
                const mediumFlightDist = 1500;
                const longFlightDist = 4000;
                transport += (inputs.flightsShortPerYear * shortFlightDist * EMISSION_FACTORS.transport.plane_short) / 1000;
                transport += (inputs.flightsMediumPerYear * mediumFlightDist * EMISSION_FACTORS.transport.plane_medium) / 1000;
                transport += (inputs.flightsLongPerYear * longFlightDist * EMISSION_FACTORS.transport.plane_long) / 1000;

                food = EMISSION_FACTORS.diet[inputs.dietType] || 0;

                energy += (inputs.annualKWh * EMISSION_FACTORS.energy.electricity_kwh) / 1000;

                let heatingFactor = 0;
                if (inputs.primaryHeatingFuel === 'natural_gas') heatingFactor = EMISSION_FACTORS.energy.natural_gas_therm;
                else if (inputs.primaryHeatingFuel === 'heating_oil') heatingFactor = EMISSION_FACTORS.energy.heating_oil_gallon;
                else if (inputs.primaryHeatingFuel === 'propane') heatingFactor = EMISSION_FACTORS.energy.propane_gallon;

                energy += (inputs.annualHeatingUnits * heatingFactor) / 1000;

                goods = EMISSION_FACTORS.goods[inputs.shoppingHabits] || 0;

                const total = transport + food + energy + goods;

                setUser(prev => ({...prev, footprint: total}));

                return {
                    transport: transport,
                    food: food,
                    energy: energy,
                    goods: goods,
                    total: total
                };
            }, [inputs]);

            const generateRecommendations = (calculatedFootprint, details) => {
                const recommendations = [];
                const msgs = t.recommendations.messages;

                if (calculatedFootprint > 15) {
                    recommendations.push(msgs.highFootprint);
                }

                if (details.transport > 4) {
                    if(inputs.primaryVehicle.includes('car')) {
                        recommendations.push(msgs.transport.highCar);
                    }
                    if(inputs.flightsLongPerYear > 1 || inputs.flightsMediumPerYear > 3) {
                        recommendations.push(msgs.transport.highFlights);
                    }
                } else if (details.transport > 2) {
                    recommendations.push(msgs.transport.medium);
                }

                if (details.food > 2.8) {
                    recommendations.push(msgs.food.high);
                } else if (details.food > 2.0) {
                    recommendations.push(msgs.food.medium);
                }

                if (details.energy > 3) {
                    recommendations.push(msgs.energy.high);
                    if(inputs.primaryHeatingFuel !== 'electric' && inputs.primaryHeatingFuel !== 'other_renewable') {
                        recommendations.push(msgs.energy.heating);
                    }
                } else if (details.energy > 1.5) {
                    recommendations.push(msgs.energy.medium);
                }

                if (details.goods > 2.5) {
                    recommendations.push(msgs.goods.high);
                } else if (details.goods > 1.2) {
                    recommendations.push(msgs.goods.medium);
                }

                if (calculatedFootprint < 7) {
                    recommendations.push(msgs.lowFootprint);
                    if (recommendations.length === 1) {
                        recommendations.push(msgs.solar);
                    }
                }

                let recIndex = 0;
                while (recommendations.length < 3 && recIndex < msgs.generic.length) {
                    if (!recommendations.includes(msgs.generic[recIndex])) {
                        recommendations.push(msgs.generic[recIndex]);
                    }
                    recIndex++;
                }

                return recommendations.slice(0, 4);
            };

            const totalFootprint = footprintData.total;

            return (
                <div className="max-w-3xl mx-auto px-4 py-6">
                    <header className="flex items-center justify-between mb-6">
                        <div className="flex items-center">
                            <span className="text-primary text-4xl mr-2">ğŸŒ±</span>
                            <h1 className="text-2xl font-bold">{t.title}</h1>
                        </div>
                        <div className="flex gap-2">
                            <button 
                                onClick={() => setLanguage('zh')}
                                className={`px-4 py-2 rounded-lg transition ${
                                    language === 'zh' 
                                    ? 'bg-primary text-white' 
                                    : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300'
                                }`}
                            >
                                ç¹é«”ä¸­æ–‡
                            </button>
                            <button 
                                onClick={() => setLanguage('en')}
                                className={`px-4 py-2 rounded-lg transition ${
                                    language === 'en' 
                                    ? 'bg-primary text-white' 
                                    : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300'
                                }`}
                            >
                                English
                            </button>
                        </div>
                    </header>

                    <main>
                        <div className="space-y-6">
                            <div className="bg-white dark:bg-darkcard rounded-lg shadow p-4">
                                <h2 className="text-xl font-bold mb-4">{t.lifestyle}</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">

                                    <fieldset className="border dark:border-gray-700 p-3 rounded">
                                        <legend className="text-lg font-semibold px-1">{t.transport.title}</legend>
                                        <div className="space-y-3">
                                            <div>
                                                <label htmlFor="primaryVehicle">{t.transport.primaryVehicle}</label>
                                                <select id="primaryVehicle" name="primaryVehicle" value={inputs.primaryVehicle} onChange={handleInputChange}>
                                                    {Object.entries(t.transport.vehicles).map(([value, label]) => (
                                                        <option key={value} value={value}>{label}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            <div>
                                                <label htmlFor="weeklyMilesDriven">{t.transport.weeklyMiles}</label>
                                                <input type="number" id="weeklyMilesDriven" name="weeklyMilesDriven" value={inputs.weeklyMilesDriven} onChange={handleInputChange} min="0" />
                                            </div>
                                            <div>
                                                <label htmlFor="publicTransportMiles">{t.transport.publicMiles}</label>
                                                <input type="number" id="publicTransportMiles" name="publicTransportMiles" value={inputs.publicTransportMiles} onChange={handleInputChange} min="0" />
                                            </div>
                                            <div className="grid grid-cols-3 gap-2">
                                                <div>
                                                    <label htmlFor="flightsShortPerYear" className="text-xs">{t.transport.flights.short}</label>
                                                    <input type="number" id="flightsShortPerYear" name="flightsShortPerYear" value={inputs.flightsShortPerYear} onChange={handleInputChange} min="0" />
                                                </div>
                                                <div>
                                                    <label htmlFor="flightsMediumPerYear" className="text-xs">{t.transport.flights.medium}</label>
                                                    <input type="number" id="flightsMediumPerYear" name="flightsMediumPerYear" value={inputs.flightsMediumPerYear} onChange={handleInputChange} min="0" />
                                                </div>
                                                <div>
                                                    <label htmlFor="flightsLongPerYear" className="text-xs">{t.transport.flights.long}</label>
                                                    <input type="number" id="flightsLongPerYear" name="flightsLongPerYear" value={inputs.flightsLongPerYear} onChange={handleInputChange} min="0" />
                                                </div>
                                            </div>
                                            <p className="text-sm font-medium text-right">{t.transport.estimate}: {footprintData.transport.toFixed(1)} {t.footprint.total}</p>
                                        </div>
                                    </fieldset>

                                    <fieldset className="border dark:border-gray-700 p-3 rounded">
                                        <legend className="text-lg font-semibold px-1">{t.food.title}</legend>
                                        <div className="space-y-3">
                                            <div>
                                                <label htmlFor="dietType">{t.food.dietType}</label>
                                                <select id="dietType" name="dietType" value={inputs.dietType} onChange={handleInputChange}>
                                                    {Object.entries(t.food.diets).map(([value, label]) => (
                                                        <option key={value} value={value}>{label}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            <p className="text-sm font-medium text-right pt-4">{t.food.estimate}: {footprintData.food.toFixed(1)} {t.footprint.total}</p>
                                        </div>
                                    </fieldset>

                                    <fieldset className="border dark:border-gray-700 p-3 rounded">
                                        <legend className="text-lg font-semibold px-1">{t.energy.title}</legend>
                                        <div className="space-y-3">
                                            <div>
                                                <label htmlFor="homeType">{t.energy.homeType}</label>
                                                <select id="homeType" name="homeType" value={inputs.homeType} onChange={handleInputChange}>
                                                    {Object.entries(t.energy.homes).map(([value, label]) => (
                                                        <option key={value} value={value}>{label}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            <div>
                                                <label htmlFor="primaryHeatingFuel">{t.energy.heatingSource}</label>
                                                <select id="primaryHeatingFuel" name="primaryHeatingFuel" value={inputs.primaryHeatingFuel} onChange={handleInputChange}>
                                                    {Object.entries(t.energy.heating).map(([value, label]) => (
                                                        <option key={value} value={value}>{label}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            <div>
                                                <label htmlFor="electricityUsageKnown" className="inline-flex items-center">
                                                    <input type="checkbox" id="electricityUsageKnown" name="electricityUsageKnown" checked={inputs.electricityUsageKnown} onChange={handleInputChange} className="mr-2"/>
                                                    {t.energy.manualElectricity}
                                                </label>
                                                {inputs.electricityUsageKnown && (
                                                    <div className="mt-1">
                                                        <label htmlFor="annualKWh">{t.energy.annualElectricity}</label>
                                                        <input type="number" id="annualKWh" name="annualKWh" value={inputs.annualKWh} onChange={handleInputChange} min="0"/>
                                                    </div>
                                                )}
                                            </div>
                                            {inputs.primaryHeatingFuel !== 'electric' && inputs.primaryHeatingFuel !== 'other_renewable' && (
                                                <div>
                                                    <label htmlFor="heatingUsageKnown" className="inline-flex items-center">
                                                        <input type="checkbox" id="heatingUsageKnown" name="heatingUsageKnown" checked={inputs.heatingUsageKnown} onChange={handleInputChange} className="mr-2"/>
                                                        {t.energy.manualHeating}
                                                    </label>
                                                    {inputs.heatingUsageKnown && (
                                                        <div className="mt-1">
                                                            <label htmlFor="annualHeatingUnits">{t.energy.annualHeating} ({
                                                                inputs.primaryHeatingFuel === 'natural_gas' ? 'Therms' : 'Gallons'
                                                            })</label>
                                                            <input type="number" id="annualHeatingUnits" name="annualHeatingUnits" value={inputs.annualHeatingUnits} onChange={handleInputChange} min="0"/>
                                                        </div>
                                                    )}
                                                </div>
                                            )}
                                            <p className="text-sm font-medium text-right">{t.energy.estimate}: {footprintData.energy.toFixed(1)} {t.footprint.total}</p>
                                        </div>
                                    </fieldset>

                                    <fieldset className="border dark:border-gray-700 p-3 rounded">
                                        <legend className="text-lg font-semibold px-1">{t.goods.title}</legend>
                                        <div className="space-y-3">
                                            <div>
                                                <label htmlFor="shoppingHabits">{t.goods.spending}</label>
                                                <select id="shoppingHabits" name="shoppingHabits" value={inputs.shoppingHabits} onChange={handleInputChange}>
                                                    {Object.entries(t.goods.levels).map(([value, label]) => (
                                                        <option key={value} value={value}>{label}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            <p className="text-sm font-medium text-right pt-4">{t.goods.estimate}: {footprintData.goods.toFixed(1)} {t.footprint.total}</p>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>

                            <div className="bg-white dark:bg-darkcard rounded-lg shadow p-4">
                                <h2 className="text-xl font-bold mb-4">{t.footprint.title}</h2>
                                <div className="flex flex-col md:flex-row gap-4 items-center">
                                    <div className="w-full md:w-1/2 space-y-2">
                                        <p>{t.footprint.transport}: {footprintData.transport.toFixed(1)} {t.footprint.total}</p>
                                        <p>{t.footprint.food}: {footprintData.food.toFixed(1)} {t.footprint.total}</p>
                                        <p>{t.footprint.energy}: {footprintData.energy.toFixed(1)} {t.footprint.total}</p>
                                        <p>{t.footprint.goods}: {footprintData.goods.toFixed(1)} {t.footprint.total}</p>
                                    </div>
                                    <div className="w-full md:w-1/2 flex flex-col items-center">
                                        <div className="text-center mb-2">
                                            <span className="text-3xl font-bold">{totalFootprint.toFixed(1)}</span>
                                            <span className="text-xl ml-1">{t.footprint.total}</span>
                                        </div>
                                        <div className="w-40 h-40 rounded-full border-8 border-gray-200 dark:border-gray-700 relative flex items-center justify-center">
                                            <div className="absolute inset-0 overflow-hidden rounded-full">
                                                <div
                                                    className="carbon-gauge absolute bottom-0 left-0 right-0 bg-gradient-to-t from-red-500 via-yellow-400 to-green-400"
                                                    style={{ height: `${Math.min(100, (totalFootprint / 20) * 100)}%` }}
                                                ></div>
                                            </div>
                                            <div className="relative z-10 text-center">
                                                <p className="text-sm font-medium">{t.footprint.impact}</p>
                                                {totalFootprint > 15 ? (
                                                    <p className="text-xs text-red-500">{t.footprint.levels.veryHigh}</p>
                                                ) : totalFootprint > 10 ? (
                                                    <p className="text-xs text-red-500">{t.footprint.levels.high}</p>
                                                ) : totalFootprint > 6 ? (
                                                    <p className="text-xs text-yellow-500">{t.footprint.levels.medium}</p>
                                                ) : (
                                                    <p className="text-xs text-green-500">{t.footprint.levels.low}</p>
                                                )}
                                            </div>
                                        </div>
                                        <p className="text-xs text-gray-500 dark:text-gray-400 mt-2">{t.footprint.averages}</p>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white dark:bg-darkcard rounded-lg shadow p-4">
                                <h2 className="text-xl font-bold mb-4">{t.recommendations.title}</h2>
                                <div className="space-y-3">
                                    {generateRecommendations(totalFootprint, footprintData).map((rec, i) => (
                                        <div key={i} className="p-3 border border-gray-200 dark:border-gray-700 rounded-lg flex items-start">
                                            <span className="mr-3 text-green-500 text-xl">âœ“</span>
                                            <p>{rec}</p>
                                        </div>
                                    ))}
                                </div>
                                <button
                                    className="mt-6 bg-primary text-white rounded-lg px-4 py-2 w-full font-medium hover:bg-opacity-90 transition"
                                    onClick={() => {
                                        setUser(prev => ({
                                            ...prev,
                                            points: prev.points + 50,
                                            actions: prev.actions + 1
                                        }));
                                        setModalContent(t.recommendations.success);
                                        setShowModal(true);
                                        setTimeout(() => setShowModal(false), 2000);
                                    }}
                                >
                                    {t.recommendations.commit}
                                </button>
                            </div>

                            <div className="bg-white dark:bg-darkcard rounded-lg shadow p-4 mt-6">
                                <h2 className="text-xl font-bold mb-4">{t.didYouKnow.title}</h2>
                                <div className="p-4 bg-blue-50 dark:bg-gray-800 rounded-lg">
                                    <p className="text-sm">
                                        {t.didYouKnow.content}
                                        <a
                                            href="https://www.anthesisgroup.com/insights/what-exactly-is-1-tonne-of-co2/#:~:text=1%20tonne%20of%20CO2%20is%20equivalent%20to%3A,trips%20of%20300%20miles%20each."
                                            className="ml-2 text-primary hover:underline"
                                            target="_blank"
                                            rel="noopener noreferrer"
                                        >
                                            {t.didYouKnow.learnMore}
                                        </a>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </main>

                    {showModal && (
                        <div className="fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white rounded-lg py-2 px-4 shadow-lg">
                            {modalContent}
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(
            <App />,
            document.getElementById('root')
        );
    </script>
</body>
</html>